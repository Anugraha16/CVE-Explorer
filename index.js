document.addEventListener('DOMContentLoaded', () => {
    fetchDataAndDisplay();
});

async function fetchDataAndDisplay(pageNumber = 1, resultsPerPage = 10) {
    try {
        const response = await fetch(`http://localhost:3000/cves?page=${pageNumber}&limit=${resultsPerPage}`);
        const data = await response.json();

        const tableBody = document.getElementById('cveTableBody');
        tableBody.innerHTML = '';

        data.forEach(cve => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td><a href="detail.html?cveId=${cve.info.id}" class="cve-link">${cve.info.id}</a></td>
                <td>${cve.info.sourceIdentifier}</td>
                <td>${cve.info.published}</td>
                <td>${cve.info.lastModified}</td>
                <td>${cve.info.vulnStatus}</td>
            `;
            tableBody.appendChild(row);
        });
        updatePagination();

    } catch (error) {
        console.error('Error fetching data:', error);
    }
}

// Function to generate and update page numbers
function updatePagination() {
    const paginationContainer = document.getElementById("pagination");
    paginationContainer.innerHTML = '';

    // Generate "Previous" button
    const prevButton = document.createElement("button");
    prevButton.innerText = "Prev";
    prevButton.addEventListener("click", function() {
        if (currentPage > 1) {
            changePage(currentPage - 1);
        }
    });
    paginationContainer.appendChild(prevButton);

    // Generate page numbers
    for (let i = Math.max(1, currentPage - 1); i <= Math.min(currentPage + 1, totalPages); i++) {
        const button = document.createElement("button");
        button.innerText = i;
        if (i === currentPage) {
            button.classList.add("active");
        }
        button.addEventListener("click", function() {
            changePage(i);
        });
        paginationContainer.appendChild(button);
    }

    // Generate "Next" button
    const nextButton = document.createElement("button");
    nextButton.innerText = "Next";
    nextButton.addEventListener("click", function() {
        if (currentPage < totalPages) {
            changePage(currentPage + 1);
        }
    });
    paginationContainer.appendChild(nextButton);
}

// To handle changing the page
function changePage(pageNumber) {
    currentPage = pageNumber;
    fetchDataAndDisplay(pageNumber);
}

function changeResultsPerPage() {
    resultsPerPage = parseInt(document.getElementById('results').value);
    totalPages = Math.ceil(totalRecords / resultsPerPage);
    currentPage = 1;
    fetchDataAndDisplay(1, resultsPerPage);
}


let totalRecords = 1000;
let resultsPerPage = 10;
let currentPage = 1;
let totalPages = Math.ceil(totalRecords / resultsPerPage);
